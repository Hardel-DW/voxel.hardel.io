---
import GithubSlugger from "github-slugger";
import {cn} from "@/lib/utils";

const slugger = new GithubSlugger();

export type Elements = {
    href: string;
    selected: boolean;
    checked: boolean;
    title: string;
    information: string;
};

interface Props {
    title: string;
    selected?: boolean;
    completed?: number;
    quest?: number;
    elements: Elements[];
}

const {title, elements, completed, selected, quest}: Props = Astro.props;
const slug = slugger.slug(title);
const progress = ((completed || 0) / elements.length) * 100;
---

<div class={cn("select-none group/card transition-opacity hover:opacity-100", {
    'opacity-100': selected,
    'opacity-50': !selected
})}>
    <!-- Card -->
    <div data-reavelcard={slug}
         class="flex flex-col justify-between rounded-t-xl w-full p-4 h-36 relative cursor-pointer border-b-0 border border-zinc-800 transition-all group-hover/card:border-zinc-600 bg-content">
        <div class="rounded-2xl font-semibold size-full">
            {title}
            <div class="text-xs font-normal mt-1 text-zinc-400">
                {quest || 0} QuÃªtes restantes
            </div>
        </div>

        <!-- Progress bar -->
        <div>
            <div class="flex justify-between text-xs mb-1 text-zinc-300">
                <span>Progression</span>
                <span>{completed || 0} / {elements.length}</span>
            </div>
            <div class="relative h-1.5 bg-zinc-600 rounded-b-xl">
                <div class="absolute inset-0 bg-blue-200 rounded-b-xl" style={{width: `${progress}%`}}></div>
            </div>
        </div>
    </div>

    <!-- Card Content -->
    <div data-cardcontent={slug}
         class="overflow-hidden border-t-0 border border-zinc-800 group-hover/card:border-zinc-600 rounded-b-xl bg-content transition-all"
         style={{maxHeight: selected ? 500 : 0}}>
        <ul class="py-4 gap-y-4 px-6 flex flex-col">
            {elements.map((element) => (
                    <li class="relative group flex items-center w-full transition rounded-xl">
                        <a href={element.href ? element.href : '#'}
                           class:list={[
                               'text-[14px] font-extralight truncate flex items-center justify-between w-full gap-x-4',
                               element.selected ? 'observed text-blue-200 font-semibold' : element.checked ? '' : 'text-zinc-300 group-hover:text-white'
                           ]}>
                            <span class="truncate">{element.title}</span>
                            <img src="/icons/lock.svg" alt="lock" class="w-4 h-4 shrink-0 invert opacity-30"/>
                        </a>

                        <div class={cn('hidden group-hover:block absolute -left-4 w-1.5 h-1.5 border border-white rotate-45',
                            {'block': element.selected}
                        )}/>

                        <div class={cn('absolute -left-4 w-3 h-3', {
                            'hidden': !element.checked,
                            'block': element.checked
                        })}>
                            <img src="/icons/check.svg" alt="Checked" class="size-full invert"/>
                        </div>
                    </li>
            ))}
        </ul>
    </div>
</div>

<script>
    const cards = document.querySelectorAll('[data-reavelcard]');
    for (const card of cards) {
        card.addEventListener('click', () => {
            const content = card.nextElementSibling as HTMLElement;
            content.style.maxHeight = content.style.maxHeight === '0px' ? `${content.scrollHeight}px` : '0px';
        });
    }
</script>