---
const slides = [
    {
        title: "NeoEnchant+",
        description: "Un datapack qui révolutionne le système d'enchantement de Minecraft",
        image: "/images/background/datapacks/neoenchant.webp"
    },
    {
        title: "Yggdrasil",
        description: "Explorez un monde mystique rempli de structures et d'aventures",
        image: "/images/background/datapacks/yggdrasil.webp"
    },
    {
        title: "BeyondEnchant",
        description: "Repoussez les limites des enchantements classiques",
        image: "/images/background/datapacks/beyond.webp"
    }
];
---

<div class="relative w-full h-full overflow-hidden">
    <!-- Gradients -->
    <div class="absolute h-full w-32 z-10 bg-gradient-to-r from-black/50 from-5% to-transparent"/>

    <!-- Single Slide -->
    <div class="slides-container relative w-full h-full">
        <div data-slide class="relative w-full h-full transition-opacity duration-500">
            <div class="relative w-full h-full">
                <img 
                    data-slide-image
                    src={slides[0].image} 
                    alt={slides[0].title} 
                    class="w-full h-full object-cover mask-fade-top"
                />
            </div>
            <div class="absolute bottom-1/2 left-20 z-20 max-w-xl">
                <h2 data-slide-title class="text-4xl font-bold text-white">{slides[0].title}</h2>
                <p data-slide-description class="text-gray-200 mt-2">
                    Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos. Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos. Lorem ipsum dolor sit amet consectetur adipisicing elit. Quisquam, quos.
                </p>
                <div class="flex gap-2 mt-6">
                    {slides.map((_, index) => (
                        <div 
                            class="w-6 h-2 rounded-full bg-white/50 cursor-pointer overflow-hidden transition-all duration-300" 
                            data-index={index}
                            data-pagination
                        >
                            <div 
                                class="h-full w-full rounded-full bg-pink-700 transform origin-left scale-x-0 opacity-100"
                                data-progress
                            ></div>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    let currentSlide = 0;
    const slideElement = document.querySelector<HTMLElement>('[data-slide]');
    const slideImage = document.querySelector<HTMLImageElement>('[data-slide-image]');
    const slideTitle = document.querySelector<HTMLElement>('[data-slide-title]');
    const slideDescription = document.querySelector<HTMLElement>('[data-slide-description]');
    const paginationItems = document.querySelectorAll<HTMLElement>('[data-pagination]');
    const slides = [
        {
            title: "NeoEnchant+",
            description: "Un datapack qui révolutionne le système d'enchantement de Minecraft",
            image: "/images/background/datapacks/neoenchant.webp"
        },
        {
            title: "Yggdrasil",
            description: "Explorez un monde mystique rempli de structures et d'aventures",
            image: "/images/background/datapacks/yggdrasil.webp"
        },
        {
            title: "BeyondEnchant",
            description: "Repoussez les limites des enchantements classiques",
            image: "/images/background/datapacks/beyond.webp"
        }
    ];
    const slidesCount = slides.length;
    let slideInterval: ReturnType<typeof setInterval>;

    function updateSlideContent(index: number) {
        if (!slideImage || !slideTitle || !slideDescription || !slideElement) return;
        
        // Hide slide during content update
        slideElement.classList.remove('opacity-100');
        slideElement.classList.add('opacity-50');
        
        // Update content
        setTimeout(() => {
            slideImage.src = slides[index].image;
            slideImage.alt = slides[index].title;
            slideTitle.textContent = slides[index].title;
            slideDescription.textContent = slides[index].description;
            
            // Show slide
            slideElement.classList.remove('opacity-50');
            slideElement.classList.add('opacity-100');
        }, 200);
    }

    function updatePagination(index: number) {
        for (const [i, paginationItem] of Array.from(paginationItems).entries()) {
            const progressBar = paginationItem.querySelector<HTMLElement>('[data-progress]');
            if (!progressBar) continue;

            // Reset styles
            progressBar.style.transition = 'none';
            progressBar.style.transform = 'scaleX(0)';
            progressBar.style.opacity = '1';
            
            // Update sizes
            if (i === index) {
                paginationItem.style.width = '4rem';
                
                // Force reflow
                void progressBar.offsetWidth;
                
                progressBar.style.transition = 'transform 5s linear, opacity 0.3s linear 4.7s';
                progressBar.style.transform = 'scaleX(1)';
                progressBar.style.opacity = '0';
            } else {
                paginationItem.style.width = '1.5rem';
            }
        }
    }

    function showSlide(index: number) {
        updateSlideContent(index);
        updatePagination(index);
    }

    function nextSlide() {
        currentSlide = (currentSlide + 1) % slidesCount;
        showSlide(currentSlide);
    }

    function startSlideshow() {
        showSlide(0);
        slideInterval = setInterval(nextSlide, 5000);
    }

    // Event listeners
    for (const [index, item] of Array.from(paginationItems).entries()) {
        item.addEventListener('click', () => {
            clearInterval(slideInterval);
            currentSlide = index;
            showSlide(currentSlide);
            slideInterval = setInterval(nextSlide, 5000);
        });
    }

    startSlideshow();
</script>

<style>
    .mask-fade-top {
        mask-image: linear-gradient(to bottom, rgba(0,0,0,1) 50%, rgba(0,0,0,0) 100%);
    }
</style>