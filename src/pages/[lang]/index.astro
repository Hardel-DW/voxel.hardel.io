---
import { Image } from "astro:assets";
import { getCollection } from "astro:content";
import CompoundLayout from "@/components/layouts/CompoundLayout.astro";
import BlogCard from "@/components/ui/BlogCard.astro";
import Box from "@/components/ui/Box.astro";
import Slides from "@/components/ui/Slides.astro";
import Button from "@/components/ui/button.astro";
import DashedPattern from "@/components/ui/pattern/DashedPattern.astro";
import Fog from "@/components/ui/pattern/Fog.astro";
import ShiningStars from "@/components/ui/pattern/ShiningStars.astro";
import Vortex from "@/components/ui/pattern/Vortex.astro";
import { getTranslations, names } from "@/lib/i18n";

const { lang, translate } = await getTranslations(Astro.url);
const blogs = await getCollection("blog", ({ data, id }) => {
    return !data.draft && data.publishDate < new Date() && id.split("/")[0] === lang;
});

const sortedBlogs = blogs
    .sort((a, b) => {
        return b.data.publishDate.valueOf() - a.data.publishDate.valueOf();
    })
    .slice(0, 3);

const slides = [
    {
        title: translate["datapacks.neoenchant.personalize.title"],
        description: translate["datapacks.neoenchant.personalize.description"],
        image: "/images/background/tools/enchant-hero.webp",
        button: {
            main: {
                href: `/${lang}/tools/enchant`,
                text: translate["generic.start"]
            },
            secondary: {
                href: `/${lang}/blog/enchant-configurator`,
                text: translate["generic.learn_more"]
            }
        }
    },
    {
        title: translate["home.resource.title"],
        description: translate["home.resource.description"],
        image: "/images/background/marketplace.webp",
        button: {
            main: {
                href: `/${lang}/resources/asset`,
                text: translate["generic.take_a_look"]
            },
            secondary: {
                href: `/${lang}/resources/asset`,
                text: translate["generic.learn_more"]
            }
        }
    },
    {
        title: translate["home.datapack.title"],
        description: translate["home.datapack.description"],
        image: "/images/background/datapack.webp",
        button: {
            main: {
                href: "/",
                text: translate["generic.take_a_look"]
            },
            secondary: {
                href: "/",
                text: translate["generic.learn_more"]
            }
        }
    },
    {
        title: translate["home.wiki.title"],
        description: translate["home.wiki.description"],
        image: "/images/tools/yggdrasil_loot.webp",
        button: {
            main: {
                href: "/",
                text: translate["generic.take_a_look"]
            },
            secondary: {
                href: "/",
                text: translate["generic.learn_more"]
            }
        }
    }
];

export const prerender = true;
export async function getStaticPaths() {
    return names.map((element) => ({
        params: { lang: element.lang }
    }));
}
---

<CompoundLayout>
    <div>
        <!-- Background -->
        <div class="absolute rounded-full w-3/4 h-1/2 bg-linear-to-r from-[#401727] to-[#311e7696] opacity-20 blur-[10rem] top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2"/>

        <!-- Shining stars -->
        <div class="fixed inset-0 -z-10">
            <ShiningStars/>
        </div>

        <!-- Particles -->
        <div class="absolute inset-0 h-full overflow-hidden p-8 opacity-50">
            <Vortex/>
        </div>
        
        <!-- Main view -->
        <section class="h-dvh" data-direction="horizontal">
            <div class="absolute w-full inset-0 shadow-2xl bg-linear-to-r from-[#401727] to-[#311e7696] opacity-20 rounded-full blur-[10rem]"/>

            <div class="h-full w-3/4 mx-auto flex xl:grid grid-cols-2 items-center gap-8 transition-all duration-500"
                 data-effect>
                <div class="h-full w-[95%] md:w-full mx-auto relative">
                    <div class="xl:invisible visible absolute flex justify-center items-center size-full -z-10">
                        <div class="absolute inset-0 top-1/2 -translate-y-1/2 shadow-2xl bg-linear-to-r from-pink-900 to-blue-900 opacity-50 rounded-full blur-[5rem]"/>
                    </div>

                    <div class="size-full flex flex-col justify-center" data-slide>
                        <small class="text-pink-700 font-bold tracking-wide text-[16px]">
                            {translate["generic.section"]}
                        </small>
                        <h1 class="text-white text-4xl md:text-6xl font-bold mt-4 text-balance" data-slide-title>
                            {slides[0].title}
                        </h1>
                        <p class="text-gray-300 mt-4" data-slide-description>
                            {slides[0].description}
                        </p>

                        <div class="mt-8 flex gap-4">
                            <Button href={slides[0].button.main.href} size="xl" variant="primary"
                                    data-slide-button-main>
                                {slides[0].button.main.text}
                            </Button>
                            <Button href={slides[0].button.secondary.href} size="xl" variant="ghost"
                                    data-slide-button-secondary>
                                {slides[0].button.secondary.text}
                            </Button>
                        </div>
                    </div>
                </div>
                <div class="relative w-full hidden xl:flex justify-center items-center">
                    <img class="absolute opacity-10 select-none" src="/icons/circle.svg" alt="box"/>
                    <img loading="eager" width="1200" height="900" src={slides[0].image} alt="404" data-slide-image
                         class="aspect-auto select-none"/>
                </div>
            </div>
            <Slides numberOfSlides={slides.length} direction="horizontal"
                    class="absolute left-1/2 -translate-x-1/2 bottom-20"/>
        </section>

        <!-- Features -->
        <section class="mb-20 md:mb-40 md:mt-20 pb-52 w-3/4 mx-auto xl:grid grid-cols-2 gap-40 relative">
            <div class="absolute w-10/12 h-full -translate-x-1/2 left-1/2 bottom-0 top-1/2 -translate-y-1/2">
                <Fog/>
            </div>

            <div class="hidden xl:flex justify-center items-center relative w-full">
                <Image loading="eager" width="442" height="544" src="/images/features/skin/avatar.webp" alt="404"
                       class="w-1/2 aspect-auto animate-levitate scale-x-[-1] select-none"/>
                <img class="absolute opacity-10 select-none" src="/icons/circle.svg" alt="box"/>
            </div>

            <div class="w-[95%] xl:w-full mx-auto">
                <small class="text-pink-700 font-bold tracking-wide text-[16px]">
                    {translate["generic.section"]}
                </small>
                <h1 class="text-white text-4xl md:text-5xl font-bold mt-4">
                    {translate["home.feature.title"]}
                </h1>
                <p class="text-zinc-400 text-sm md:text-base mt-6">
                    {translate["home.feature.description"]}
                </p>

                <div class="grid grid-cols-3 gap-4 mt-8">
                    <div class="relative flex items-center justify-center bg-zinc-900 border border-zinc-700 px-3 py-4 rounded-xl shadow-xl shadow-zinc-950 overflow-hidden">
                        <h2 class="text-white text-sm md:text-base font-bold text-center">
                            {translate["home.feature.keyword"]}
                        </h2>
                    </div>
                    <div class="relative flex items-center justify-center bg-zinc-900 border border-zinc-700 px-3 py-4 rounded-xl shadow-xl shadow-zinc-950 overflow-hidden">
                        <h2 class="text-white text-sm md:text-base font-bold text-center">
                            {translate["home.feature.keyword_2"]}
                        </h2>
                    </div>
                    <div class="relative flex items-center justify-center bg-zinc-900 border border-zinc-700 px-3 py-4 rounded-xl shadow-xl shadow-zinc-950 overflow-hidden">
                        <h2 class="text-white text-sm md:text-base font-bold text-center">
                            {translate["home.feature.keyword_3"]}
                        </h2>
                    </div>
                </div>
            </div>
        </section>

        <!-- Product -->
        <section class="my-32 md:my-52 px-8 w-full md:w-3/4 xl:w-1/2 mx-auto grid md:grid-cols-2 gap-8">
            <Box variant="big" loading="eager" image="/images/features/dev.webp">
                <h2 class="text-white text-xl md:text-2xl font-bold line-clamp-1 pt-8">
                    {translate["home.product.tools.title"]}
                </h2>
                <p class="text-zinc-400 text-sm md:text-base mt-2 line-clamp-3">
                    {translate["home.product.tools.description"]}
                </p>
                <div class="flex flex-wrap gap-2 mt-6">
                    <Button class="w-full xl:w-fit" href={`/${lang}/tools/enchant`} size="sm" variant="primary">
                        {translate["generic.start"]}
                    </Button>
                    <Button class="w-full xl:w-fit" href={`/${lang}/blog/enchant-configurator`} size="sm"
                            variant="transparent">
                        {translate["generic.learn_more"]}
                    </Button>
                </div>
            </Box>
            <Box variant="big" loading="lazy" image="/images/features/bundle.webp">
                <h2 class="text-white text-xl md:text-2xl font-bold text-left line-clamp-1 pt-8">
                    {translate["home.product.resource.title"]}
                </h2>
                <p class="text-zinc-400 text-sm md:text-base mt-2 line-clamp-3">
                    {translate["home.product.resource.description"]}
                </p>
                <div class="flex flex-wrap gap-2 mt-6">
                    <Button class="w-full xl:w-fit" href="/resources/asset" size="sm" variant="primary">
                        {translate["generic.take_a_look"]}
                    </Button>
                    <Button class="w-full xl:w-fit" href="/resources/asset" size="sm" variant="transparent">
                        {translate["generic.learn_more"]}
                    </Button>
                </div>
            </Box>
            <Box variant="big" loading="lazy" image="/images/features/structure/tree.webp">
                <h2 class="text-white text-xl md:text-2xl font-bold text-left line-clamp-1 pt-8">
                    {translate["home.product.datapack.title"]}
                </h2>
                <p class="text-zinc-400 text-sm md:text-base mt-2 line-clamp-3">
                    {translate["home.product.datapack.description"]}
                </p>
                <div class="flex flex-wrap gap-2 mt-6">
                    <Button class="w-full xl:w-fit" href={`/${lang}/datapacks/neoenchant`} size="sm" variant="primary">
                        NeoEnchant+
                    </Button>
                    <Button class="w-full xl:w-fit" href={`/${lang}/datapacks/neoenchant`} size="sm"
                            variant="transparent">
                        Yggdrasil
                    </Button>
                </div>
            </Box>
        </section>

        <!-- Blog -->
        <section class="mt-20 pb-40 w-full flex flex-col items-center gap-10 relative rounded-t-3xl overflow-hidden">
            <DashedPattern/>
            <div class="w-3/4 pt-40">
                <h1 class="text-white text-2xl md:text-4xl font-semibold tracking-tighter mt-4 text-balance">
                    {translate["blog.actuality"]}
                </h1>
                <div class="h-1 w-full bg-zinc-700 rounded-full mt-2"/>
            </div>
            <ul class="w-3/4 grid grid-cols-3 gap-10 lg:gap-16">
                {sortedBlogs.map((post, index) => (
                    <BlogCard
                        href={`/${lang}/blog/${post.id.split("/")[1]}`}
                        src={post.data.image.src}
                        alt={post.data.image.alt}
                        slug={post.id}
                        date={post.data.publishDate}
                        lang={lang}
                        category={post.data.category}
                        title={post.data.title}
                        index={index}
                    />
                ))}
            </ul>
        </section>
    </div>
</CompoundLayout>

<script is:inline define:vars={{slides}}>
    const slideImage = document.querySelector('[data-slide-image]');
    const slideEffect = document.querySelector('[data-effect]');
    const slideTitle = document.querySelector('[data-slide-title]');
    const slideDescription = document.querySelector('[data-slide-description]');
    const slideButtonMain = document.querySelector('[data-slide-button-main]');
    const slideButtonSecondary = document.querySelector('[data-slide-button-secondary]');

    function updateSlideContent(index) {
        if (!slideImage || !slideTitle || !slideDescription) return;

        slideEffect.classList.remove('opacity-100');
        slideEffect.classList.add('opacity-50');


        setTimeout(() => {
            slideImage.src = slides[index].image;
            slideImage.alt = slides[index].title;
            slideTitle.textContent = slides[index].title;
            slideDescription.textContent = slides[index].description;
            slideButtonMain.href = slides[index].button.main.href;
            slideButtonSecondary.href = slides[index].button.secondary.href;
            slideButtonMain.textContent = slides[index].button.main.text;
            slideButtonSecondary.textContent = slides[index].button.secondary.text;
            slideEffect.classList.remove('opacity-50');
            slideEffect.classList.add('opacity-100');
        }, 200);
    }

    window.addEventListener('onSlideChange', (event) => {
        updateSlideContent(event.detail.index);
    });
</script>