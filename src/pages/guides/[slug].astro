---
import { Image } from "astro:assets";
import { getCollection, getEntry } from "astro:content";
import Button from "@/components/button.astro";
import CompoundLayout from "@/components/layouts/CompoundLayout.astro";
import GuideElement from "@/components/pages/guide/GuideElement.astro";
import GuideSection from "@/components/pages/guide/GuideSection.astro";
import LandingGuideCard from "@/components/pages/guide/LandingGuideCard.astro";
import DashedPattern from "@/components/pattern/DashedPattern.astro";
import type { InferGetStaticPropsType } from "astro";
import type { GetStaticPaths } from "astro";

export const prerender = true;
export const getStaticPaths = (async () => {
    const guides = await getCollection("guide", ({ data }) => !data.metadata.draft && data.metadata.publishDate < new Date());

    return guides.map((post) => ({
        params: { slug: post.id },
        props: { entry: post, data: post.data }
    }));
}) satisfies GetStaticPaths;

type Props = InferGetStaticPropsType<typeof getStaticPaths>;
const { data }: Props = Astro.props;
const { slug } = Astro.params;
const firstSection = data.sections[0];
const firstArticle = firstSection.article[0];
const path = ["/guides", slug, firstSection.slug, firstArticle.redirect].join("/");
---

<CompoundLayout transparent={false} title="Voxel - Guide">
    <div class="fixed -z-20 inset-0 bg-cover bg-center bg-no-repeat opacity-10 blur-3xl"
         style={{backgroundImage: `url(${data.metadata.images.src})`}}>
    </div>

    <main>
        <section class="relative pt-40 pb-16 overflow-hidden">
            <div class="w-5/6 mx-auto md:p-8 flex flex-col-reverse xl:flex-row justify-between items-center gap-8 relative z-10">
                <div class="w-full xl:w-1/2 flex items-center justify-center">
                    <div class="w-11/12">
                        <small class="text-sm md:text-base text-pink-600 font-bold tracking-wide">- VOXEL</small>
                        <h1 class="text-2xl md:text-4xl font-bold text-white pt-2">
                            {data.metadata.snippet}
                        </h1>
                        <p class="text-gray-300 mt-2 text-sm w-11/12">
                            Ce pack contient les guides pour Forge, Fabric et NeoForge, des ressources exclusives,
                            des exemples de code et du support personnalis√©.
                        </p>
                        <div class="mt-8 flex gap-4">
                            <Button href="/guides" size="xl" variant="primary">Commencer</Button>
                        </div>
                    </div>
                </div>
                <div class="w-full xl:w-1/2 transition duration-300 ease-in-out">
                    <a class="stack relative group" href={`/guides/${slug}`}>
                        <Image width={800} height={600}
                               loading="eager" decoding="sync"
                               src={data.metadata.images.src}
                               alt={data.metadata.images.alt}
                               class="w-full rounded-2xl object-cover shadow-md group-hover:shadow-xl transition-shadow duration-300 ease-in-out"
                        />
                        <div class="rounded-2xl bg-gradient-to-t from-black/30 to-transparent"/>
                    </a>
                </div>
            </div>
        </section>
        {data.presentations && (
                <section class="mt-20 pb-20 mx-auto max-w-7xl relative">
                    <div class="space-y-2 mb-8">
                        <h1 class="text-zinc-200 tracking-wide text-center text-4xl font-bold">
                            Ce que tu vas apprendre
                        </h1>
                        <div class="flex justify-center">
                            <div class="h-1 w-20 bg-zinc-400 rounded-full"></div>
                        </div>
                    </div>

                    <div class="sm:grid md:grid-cols-2 xl:grid-cols-4 gap-x-8">
                        {data.presentations.cards?.map((card) =>
                                <LandingGuideCard>
                                    <Fragment slot="title">{card.title}</Fragment>
                                    <Fragment slot="content">{card.description}</Fragment>
                                </LandingGuideCard>
                        )}
                    </div>
                </section>
        )}

        <section class="my-20 mx-auto w-2/3 space-y-16 relative">
            <DashedPattern
                    class="[mask-image:radial-gradient(white,transparent_75%)]"/>

            {data.sections.map((section) =>
                    <GuideSection>
                        <Fragment slot="title">{section.title}</Fragment>
                        {section.article.map((article) =>
                                <GuideElement {...article}
                                              redirect={[section.slug, section.slug, article.redirect].join('/')}/>)}
                    </GuideSection>
            )}
        </section>
    </main>
</CompoundLayout>

